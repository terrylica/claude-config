# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Purpose

This directory contains mpv-related configuration, scripts, and knowledge base materials for managing the mpv media player on macOS.

## System Configuration

**mpv Installation**:
- CLI: `/opt/homebrew/bin/mpv` (Homebrew formula)
- GUI: `/Applications/mpv.app` (Homebrew cask: `stolendata-mpv`)
- Bundle ID: `io.mpv`
- Version: v0.40.0 with libplacebo v7.351.0, FFmpeg 8.0

**Configuration Location**: `~/.config/mpv/`
- `mpv.conf` - Main configuration file
- `watch_later/` - Playback position resume data

**Key Settings** (`~/.config/mpv/mpv.conf`):
- Auto-resume playback: `save-position-on-quit=yes`
- Hardware acceleration: `hwdec=auto-safe` (macOS VideoToolbox)
- Cache: 500MB demuxer, 100MB backward buffer
- Screenshots: PNG format â†’ `~/Pictures/mpv-screenshots/`

## File Association Management

**Default Application Setup**:
```bash
# Set mpv as default for MKV files
duti -s io.mpv mkv all

# Verify current default
duti -x mkv

# Set for additional formats
duti -s io.mpv mp4 all
duti -s io.mpv avi all
duti -s io.mpv mov all
duti -s io.mpv webm all
```

## Common Operations

**Launch Methods**:
```bash
# CLI with file
mpv /path/to/video.mkv

# GUI application
open -a mpv /path/to/video.mkv

# With specific options
mpv --fullscreen --volume=50 video.mp4
```

**Useful mpv Options**:
- `--screenshot-directory=PATH` - Custom screenshot location
- `--sub-file=FILE` - Load external subtitle file
- `--audio-device=help` - List available audio devices
- `--hwdec=no` - Disable hardware acceleration
- `--vo=help` - List available video output drivers

## Video Stream Detection & Download

**Comprehensive Guide**: [`downie-alternatives-setup-guide.md`](downie-alternatives-setup-guide.md) - Open-source alternatives to Downie for stream detection and download.

**Core Toolchain**:
- **yt-dlp**: Universal downloader (1000+ sites, browser cookie support)
- **Streamlink**: Live stream player (Twitch, Kick, YouTube Live)
- **N_m3u8DL-RE**: HLS/DASH specialist (complex playlists)
- **The Stream Detector**: Browser extension (auto-detect streams)

**Quick Examples**:
```bash
# Download with yt-dlp
yt-dlp "https://example.com/video"

# Play live stream in mpv
streamlink --player mpv "https://twitch.tv/channel" best

# Use browser cookies for authenticated content
yt-dlp --cookies-from-browser firefox "https://site.com/video"

# Play any URL in mpv (uses yt-dlp via ytdl_hook)
mpv "https://youtube.com/watch?v=..."
```

**Installation**:
```bash
brew install yt-dlp ffmpeg streamlink

# N_m3u8DL-RE (see guide for details)
# The Stream Detector (Firefox/Chrome extension)
```

## Documentation & Resources

**Official Documentation**:
- Manual: `man mpv` or `mpv --help`
- Online: https://mpv.io/manual/stable/
- Configuration: https://github.com/mpv-player/mpv/wiki

**Key Concepts**:
- mpv uses a powerful input system with key bindings (default: `~/.config/mpv/input.conf`)
- Lua/JavaScript scripting support for extensions (`~/.config/mpv/scripts/`)
- GPU-accelerated playback via libplacebo (HDR, upscaling, tone mapping)
