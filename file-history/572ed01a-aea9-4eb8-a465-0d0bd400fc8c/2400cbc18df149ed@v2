#!/bin/bash
# Aggregate remaining SWAP months (skip already aggregated ones)

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"
PYTHON="$(cd "$PROJECT_ROOT/.." && pwd)/.venv/bin/python"

cd "$PROJECT_ROOT"

echo "Aggregating remaining SWAP months..."

# All SWAP months
SWAP_MONTHS=(
  "2023 1" "2023 2" "2023 3" "2023 4" "2023 6" "2023 7" "2023 9" "2023 10" "2023 11" "2023 12"
  "2024 1" "2024 2" "2024 3" "2024 4" "2024 5" "2024 6" "2024 7" "2024 8" "2024 9" "2024 10" "2024 11" "2024 12"
  "2025 1" "2025 2" "2025 3" "2025 4" "2025 5" "2025 6"
)

for month_spec in "${SWAP_MONTHS[@]}"; do
  read -r year month <<< "$month_spec"
  OUT_FILE="data/1min_bars_swap/$year/$(printf '%02d' $month).parquet"

  if [ ! -f "$OUT_FILE" ]; then
    echo "  SWAP $year-$(printf '%02d' $month)..."
    $PYTHON scripts/aggregate_month.py $year $month --market-type swap
  fi
done

echo ""
echo "âœ… All SWAP aggregations complete"
