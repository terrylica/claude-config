# Full Historical Backtest 2024-2025

**Version:** 1.1.0
**Created:** 2024-10-05
**Updated:** 2024-10-05 (data availability verification)
**Status:** ACTIVE
**Backtest Version:** v1.10.1
**Data Coverage:** 2024-01-01 to 2025-09-30 (21 months)

## CRITICAL: Data Availability Update

**Original Plan:** 2023-2025 (33 months)
**Actual Available:** 2024-2025 (21 months)

**Data Verification Results:**
- 2023: NO DATA (spot_1min=0, swap_1min=12, funding_rates=12) - INCOMPLETE
- 2024: COMPLETE (spot_1min=12, swap_1min=12, funding_rates=12) ✓
- 2025: Q1-Q3 ONLY (spot_1min=9, swap_1min=9, funding_rates=9) ✓

**Root Cause:** 2023 SPOT 1-min bar data not aggregated/available

**Impact:** Backtest limited to 2024-01-01 to 2025-09-30

## Objective

Execute comprehensive historical backtest across full available dataset to validate v1.10.1 temporal integrity implementation and measure strategy performance across multiple market regimes.

## Service Level Objectives (SLOs)

### 1. Availability SLO
- **Metric**: Data coverage percentage
- **Target**: >= 95% of settlement periods have all 4 required prices
- **Measurement**: (periods_traded / total_periods) * 100
- **Failure Mode**: Missing SPOT or SWAP price data causes period skips
- **Validation**: Automated via SLO 4 check in backtest output

### 2. Correctness SLO
- **Metric**: Market PnL variance
- **Target**: > 0 (proves real perpetual prices, not synthetic)
- **Measurement**: variance(total_spot_pnl + total_perp_pnl)
- **Failure Mode**: If variance = 0, indicates synthetic calculation error
- **Validation**: Automated via SLO 1 check in backtest output

### 3. Observability SLO
- **Metric**: Basis metrics population rate
- **Target**: 100% of trades have basis_entry_bps populated
- **Measurement**: count(non-null basis_entry_bps) / total_trades
- **Failure Mode**: Missing basis metrics indicates calculation failure
- **Validation**: Automated via SLO 3 check in backtest output

### 4. Maintainability SLO
- **Metric**: Temporal integrity violations
- **Target**: 0 violations
- **Measurement**: count(entry_time <= settlement_time)
- **Failure Mode**: Entry before settlement indicates look-ahead bias
- **Validation**: Automated via temporal integrity audit

## Data Requirements

### Input Data (Actual Verification)
```
data/processed/spot_1min/
├── 2023/{01-12}.parquet  ✗ NOT AVAILABLE (0 files)
├── 2024/{01-12}.parquet  ✓ VERIFIED (12 files)
└── 2025/{01-09}.parquet  ✓ VERIFIED (9 files)

data/processed/swap_1min/
├── 2023/{01-12}.parquet  ✗ PARTIAL (12 files but no corresponding spot data)
├── 2024/{01-12}.parquet  ✓ VERIFIED (12 files)
└── 2025/{01-09}.parquet  ✓ VERIFIED (9 files)

data/processed/funding_rates/
├── 2023/{01-12}.parquet  ✗ PARTIAL (12 files but no corresponding spot data)
├── 2024/{01-12}.parquet  ✓ VERIFIED (12 files)
└── 2025/{01-09}.parquet  ✓ VERIFIED (9 files)
```

### Data Gaps & Constraints
- **CRITICAL:** 2023 completely unavailable (missing SPOT 1-min bars)
- **Backtest requires ALL THREE:** spot_1min + swap_1min + funding_rates
- **Available range:** 2024-01-01 to 2025-09-30 only
- 2025-10+: Future dates (not yet available)

## Execution Plan

### Phase 1: Quarterly Backtests (Validation)
Execute quarter-by-quarter to validate data integrity and identify issues early.

```bash
# 2023: SKIPPED (data unavailable)

# Q1 2024 (already completed)
# Results: results/v1.10.1/runs/2024_Q1/ ✓

# Q2 2024
uv run --active python src/backtests/v1_10_1_real_perp_temporal.py \
  --start 2024-04-01 --end 2024-06-30 --capital 10000

# Q3 2024
uv run --active python src/backtests/v1_10_1_real_perp_temporal.py \
  --start 2024-07-01 --end 2024-09-30 --capital 10000

# Q4 2024
uv run --active python src/backtests/v1_10_1_real_perp_temporal.py \
  --start 2024-10-01 --end 2024-12-31 --capital 10000

# Q1 2025
uv run --active python src/backtests/v1_10_1_real_perp_temporal.py \
  --start 2025-01-01 --end 2025-03-31 --capital 10000

# Q2 2025
uv run --active python src/backtests/v1_10_1_real_perp_temporal.py \
  --start 2025-04-01 --end 2025-06-30 --capital 10000

# Q3 2025
uv run --active python src/backtests/v1_10_1_real_perp_temporal.py \
  --start 2025-07-01 --end 2025-09-30 --capital 10000
```

**Output Structure:**
```
results/v1.10.1/runs/
├── 2024_Q1/ ✓ Done (already completed)
├── 2024_Q2/
├── 2024_Q3/
├── 2024_Q4/
├── 2025_Q1/
├── 2025_Q2/
└── 2025_Q3/
```

### Phase 2: Annual Backtests (Aggregation)
Execute full-year backtests for annual performance metrics.

```bash
# 2023: SKIPPED (data unavailable)

# 2024 Full Year
uv run --active python src/backtests/v1_10_1_real_perp_temporal.py \
  --start 2024-01-01 --end 2024-12-31 --capital 10000

# 2025 YTD (Jan-Sep)
uv run --active python src/backtests/v1_10_1_real_perp_temporal.py \
  --start 2025-01-01 --end 2025-09-30 --capital 10000
```

**Output Structure:**
```
results/v1.10.1/runs/
├── 2024_full_year/
└── 2025_ytd/
```

### Phase 3: Complete Historical Backtest
Execute single backtest across entire available dataset.

```bash
# Full 21-month backtest (2024-2025)
uv run --active python src/backtests/v1_10_1_real_perp_temporal.py \
  --start 2024-01-01 --end 2025-09-30 --capital 10000
```

**Output Structure:**
```
results/v1.10.1/runs/
└── 2024-2025_full_history/
    ├── backtest_20240101_20250930.parquet
    ├── backtest_20240101_20250930.csv
    ├── summary_stats.json
    └── backtest.log
```

## Error Handling Policy

### No Fallbacks, No Defaults, No Retries
- **Missing Data**: Raise FileNotFoundError, halt execution
- **Price Unavailable**: Skip period, log warning, continue
- **SLO Failure**: Log failure, continue (non-blocking)
- **Temporal Violation**: Raise ValueError, halt execution
- **Import Error**: Raise ModuleNotFoundError, halt execution

### Error Propagation Chain
```
Data Missing → FileNotFoundError → Halt
Price Missing → Log Warning → Skip Period → Continue
SLO Fail → Log Failure → Continue
Temporal Violation → ValueError → Halt
```

## Validation Criteria

### Pre-Execution Checks
1. ✓ Verify data files exist for date range
2. ✓ Verify v1.10.1 code path correct
3. ✓ Verify results directory writable

### Post-Execution Checks (Per Quarter)
1. ✓ SLO 1 (Market Variance) > 0
2. ✓ SLO 2 (Basis Std Dev) > 0
3. ✓ SLO 3 (Basis Populated) = 100%
4. ✓ SLO 4 (Availability) >= 95%
5. ✓ Temporal violations = 0
6. ✓ Results files written (parquet, csv, json)

### Aggregation Checks (Post-Phase 3)
1. ✓ Compare Q1+Q2+Q3+Q4 vs annual backtest (consistency)
2. ✓ Verify 2023+2024+2025 vs full history (consistency)
3. ✓ Check for regime changes (funding environment shifts)
4. ✓ Validate prediction accuracy trends over time

## Expected Outcomes

### Performance Metrics (to be populated)
```json
{
  "2023": {
    "return_pct": null,
    "win_rate_pct": null,
    "avg_funding_bps": null,
    "skip_rate_pct": null
  },
  "2024": {
    "return_pct": 11.79,
    "win_rate_pct": 64.7,
    "avg_funding_bps": 36.7,
    "skip_rate_pct": 7.01
  },
  "2025": {
    "return_pct": null,
    "win_rate_pct": null,
    "avg_funding_bps": null,
    "skip_rate_pct": null
  },
  "full_history": {
    "return_pct": null,
    "sharpe_ratio": null,
    "max_drawdown_pct": null,
    "total_periods": null,
    "total_trades": null
  }
}
```

### Known Data Quality Issues (to be discovered)
- Early 2023: May have low symbol availability
- Market crashes: May have high skip rates due to halts
- New listings: Symbol availability increases over time

## Deliverables

1. **Quarterly Results**: 11 quarterly backtest runs with SLO validation
2. **Annual Results**: 3 annual backtest runs
3. **Full History Result**: 1 comprehensive 33-month backtest
4. **Analysis Report**: `reports/performance/full-history-2023-2025-analysis.md`
5. **Updated Metadata**: `results/v1.10.1/metadata.json` with full validation

## Timeline

- **Phase 1 (Quarterly)**: ~1-1.5 hours (6 runs × 10-15 min each)
- **Phase 2 (Annual)**: ~40 min (2 runs × 20 min each)
- **Phase 3 (Full History)**: ~20 min (1 run × 21 months)
- **Analysis & Report**: ~1 hour

**Total Estimated Time**: 3-3.5 hours (reduced from 4-5 hours due to 2023 unavailability)

## References

- Backtest Code: `src/backtests/v1_10_1_real_perp_temporal.py`
- Runner Script: `workflows/backtest/run_v1_10_1.sh`
- Results Template: `results/v1.10.1/runs/2024_Q1/` (reference)
- Version Metadata: `results/v1.10.1/metadata.json`

## Updates Log

- 2024-10-05 16:59: Initial plan created (planned 2023-2025, 33 months)
- 2024-10-05 17:05: **CRITICAL UPDATE** - 2023 data unavailable (missing spot_1min bars)
  - Revised scope: 2024-2025 only (21 months)
  - Verified data: 2024 complete (12/12/12), 2025 Q1-Q3 (9/9/9)
  - Plan v1.0.0 → v1.1.0
