# Victor CBO Analysis - OKX Funding Rate Arbitrage

**Research-Grade Backtest Framework for Funding Rate Arbitrage**

CBO: Victor Hogrefre | Auditor: Terry Li (Engineering Lead) | Strategy: Market-neutral funding rate arbitrage on OKX USDT-margined perpetuals

---

## üìÅ Canonical Directory Structure

```
victor-cbo-analysis/
‚îú‚îÄ‚îÄ src/                               # Source code (versioned)
‚îÇ   ‚îú‚îÄ‚îÄ backtests/                     # Backtest implementations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ v1_8_4_q2q3_spot_filtered.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ v1_9_synthetic_perp.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ v1_10_1_real_perp_temporal.py    # ‚ú® Current (v1.10.1)
‚îÇ   ‚îú‚îÄ‚îÄ data_pipeline/                 # Data infrastructure
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ downloaders/               # OKX CDN download scripts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ aggregators/               # Tick ‚Üí 1min bar aggregation
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/                     # Pipeline utilities
‚îÇ   ‚îî‚îÄ‚îÄ validation/                    # Validation tools
‚îÇ
‚îú‚îÄ‚îÄ workflows/                         # Orchestration scripts
‚îÇ   ‚îú‚îÄ‚îÄ download/                      # Data download workflows
‚îÇ   ‚îú‚îÄ‚îÄ aggregate/                     # Data aggregation workflows
‚îÇ   ‚îú‚îÄ‚îÄ backtest/                      # Backtest runners
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ run_v1_10_1.sh            # ‚ú® Run v1.10.1 backtest
‚îÇ   ‚îî‚îÄ‚îÄ monitoring/                    # Process monitoring
‚îÇ
‚îú‚îÄ‚îÄ data/                              # Data hierarchy (133GB)
‚îÇ   ‚îú‚îÄ‚îÄ raw/                           # Raw tick data (119GB)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ spot/                      # SPOT market ticks
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ swap/                      # SWAP (perpetual) ticks
‚îÇ   ‚îú‚îÄ‚îÄ processed/                     # Aggregated data (14GB)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ spot_1min/                 # 1-min SPOT bars
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ swap_1min/                 # 1-min SWAP bars
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ funding_rates/             # Funding rate history
‚îÇ   ‚îî‚îÄ‚îÄ metadata/                      # Data quality tracking
‚îÇ
‚îú‚îÄ‚îÄ results/                           # Backtest results (versioned)
‚îÇ   ‚îî‚îÄ‚îÄ v1.10.1/                       # ‚ú® Current version results
‚îÇ       ‚îú‚îÄ‚îÄ metadata.json              # Version info, validation status
‚îÇ       ‚îú‚îÄ‚îÄ runs/                      # Backtest runs
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ 2024_Q1/              # Q1 2024: +11.79% return
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ backtest_*.parquet # Period-level results
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ backtest_*.csv     # Human-readable format
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ summary_stats.json # Performance metrics
‚îÇ       ‚îî‚îÄ‚îÄ analysis/                  # Comparative analysis
‚îÇ
‚îú‚îÄ‚îÄ reports/                           # Analysis reports & documentation
‚îÇ   ‚îú‚îÄ‚îÄ strategy/                      # Strategy documentation
‚îÇ   ‚îú‚îÄ‚îÄ validation/                    # Temporal integrity audits
‚îÇ   ‚îú‚îÄ‚îÄ audits/                        # Code audits
‚îÇ   ‚îú‚îÄ‚îÄ performance/                   # Performance analysis
‚îÇ   ‚îî‚îÄ‚îÄ deployment/                    # Deployment planning
‚îÇ
‚îú‚îÄ‚îÄ docs/                              # Technical documentation
‚îÇ   ‚îú‚îÄ‚îÄ architecture/                  # System architecture
‚îÇ   ‚îú‚îÄ‚îÄ configuration/                 # Configuration reference
‚îÇ   ‚îú‚îÄ‚îÄ api/                           # API documentation
‚îÇ   ‚îî‚îÄ‚îÄ development/                   # Development guides
‚îÇ
‚îú‚îÄ‚îÄ tests/                             # Test suite
‚îú‚îÄ‚îÄ notebooks/                         # Jupyter analysis notebooks
‚îî‚îÄ‚îÄ .archive/                          # Historical code versions
```

---

## üöÄ Quick Start

### Run v1.10.1 Backtest

```bash
# Option 1: Using wrapper script (recommended)
./workflows/backtest/run_v1_10_1.sh 2024-01-01 2024-03-31 10000

# Option 2: Direct execution
uv run --active python src/backtests/v1_10_1_real_perp_temporal.py \
  --start 2024-01-01 \
  --end 2024-03-31 \
  --capital 10000
```

**Output**: Results saved to `results/v1.10.1/runs/2024_Q1/`

---

## üìä Latest Results (v1.10.1 on Q1 2024)

| Metric | Value |
|--------|-------|
| **Total Return** | **+11.79%** (+$1,178.70) |
| Period | 2024-01-01 to 2024-03-31 |
| Win Rate | 64.7% (163/252 periods) |
| Total Funding | $923.75 |
| Skip Rate | 7.01% (data gaps) |
| Temporal Violations | **0** ‚úÖ |
| Prediction Accuracy | 81.7% (sign) |

**Monthly Breakdown:**
- Jan 2024: -2.22% (negative funding environment)
- Feb 2024: +8.24% (strong performance)
- Mar 2024: +5.76% (continued profitability)

---

## üéØ v1.10.1 Key Features

### Temporal Integrity Guarantees
- ‚úÖ **Point-in-time symbol filtering**: Month M selections use only symbols available in month M
- ‚úÖ **No future information**: Symbols from future months cannot appear in past selections
- ‚úÖ **Execution delay**: Entry at T+1m, exit at T+8h (realistic timing)
- ‚úÖ **Data validation**: All 4 prices (spot entry/exit, perp entry/exit) required or period skipped
- ‚úÖ **Walk-forward ready**: Symbol availability advances month-by-month automatically

### Automated Validation
- **SLO 1**: Market PnL variance > 0 (proves real perp prices) ‚úÖ PASS
- **SLO 2**: Basis std dev > 0 (proves basis tracking) ‚úÖ PASS
- **SLO 3**: Basis metrics 100% populated ‚úÖ PASS
- **SLO 4**: Data availability >= 99% ‚ö† WARNING (93%)

### Real Perpetual Prices
- Uses actual SWAP market prices (not synthetic)
- Delta-neutral hedging with real basis tracking
- Market PnL variance: 1198.12 (confirms real prices)

---

## üìñ Strategy Overview

**Strategy**: Prediction-Based Selection with Spot Filter

1. **Every 8 hours**: OKX publishes predicted funding rates for next period
2. **Selection**: Choose top-5 symbols with highest positive predicted rates
3. **Filters**:
   - Positive predicted rates only
   - USDT-quoted symbols only
   - SPOT market must exist (pre-filter)
4. **Entry (T+1m)**:
   - Long spot position
   - Short perpetual position (delta-neutral)
5. **Hold 8 hours** until next settlement
6. **Exit & Collect**: Close positions, collect funding based on actual rate

**P&L Sources**:
- Funding collected (strategy target)
- Spot price change (hedged)
- Perp price change (hedged)
- Basis movement (residual risk)

---

## üõ†Ô∏è Data Pipeline

### Download Historical Data
```bash
# SPOT markets (49GB)
./workflows/download/spot_full_history.sh

# SWAP markets (70GB)
./workflows/download/swap_full_history.sh
```

### Aggregate to 1-Min Bars
```bash
# SPOT aggregation (22GB ‚Üí 8.6GB)
./workflows/aggregate/spot_full_history.sh

# SWAP aggregation (70GB ‚Üí 5.3GB)
./workflows/aggregate/swap_full_history.sh
```

**Optimal Concurrency**: c=13 parallel downloads (116.3 MB/s throughput)

---

## üìö Documentation

- **Strategy**: `reports/strategy/` - Strategy overview and upgrade plans
- **Validation**: `reports/validation/` - Temporal integrity audits
- **Performance**: `reports/performance/` - Historical analysis
- **Architecture**: `docs/architecture/` - System design
- **Configuration**: `docs/configuration/` - Setup reference

---

## ‚ö†Ô∏è Limitations & Risk Disclosure

- **NOT machine learning**: Uses exchange-provided predictions (not ML models)
- **Prediction risk**: Exchange predictions can be wrong ‚Üí negative funding possible
- **Data gaps**: Missing price data causes period skips
- **Network assumptions**: Assumes instant execution at T+1m (ignores slippage)
- **Basis risk**: Spot-perp basis can move adversely during holding period

**Example Failure Mode**: Predicted +50 bps but actual -25 bps ‚Üí pay 25 bps funding

---

## üìù Version History

- **v1.10.1** (2024-10-05): Temporal integrity validation + point-in-time filtering
- **v1.10** (2024-10-03): Real perpetual price integration
- **v1.9** (2024-10-03): Modular architecture with synthetic perp prices
- **v1.8.4** (Earlier): Q2/Q3 2025 spot-filtered backtest

---

## üìÑ License

Research-only. Not for production deployment without comprehensive risk assessment.
