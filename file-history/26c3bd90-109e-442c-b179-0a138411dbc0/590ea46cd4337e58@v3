#!/bin/bash
# Test Pushover notification with Emergency priority and "dune" sound

# Pushover credentials from CNS config
USER_KEY="ury88s1def6v16seeueoefqn1zbua1"
APP_TOKEN="aej7osoja3x8nvxgi96up2poxdjmfj"
DEVICE="iphone_13_mini"
SOUND="dune"
PRIORITY=2  # Emergency (requires acknowledgment)

# Test notification
TITLE="üß™ Pushover Test"
MESSAGE="This is a test notification from your Linux server with Emergency priority and 'dune' sound."

echo "Sending test Pushover notification..."
echo "  Device: $DEVICE"
echo "  Sound: $SOUND"
echo "  Priority: Emergency (2)"
echo ""

RESPONSE=$(curl -s https://api.pushover.net/1/messages.json \
  --form-string "token=$APP_TOKEN" \
  --form-string "user=$USER_KEY" \
  --form-string "device=$DEVICE" \
  --form-string "sound=$SOUND" \
  --form-string "priority=$PRIORITY" \
  --form-string "retry=30" \
  --form-string "expire=3600" \
  --form-string "title=$TITLE" \
  --form-string "message=$MESSAGE")

echo "Response:"
echo "$RESPONSE" | jq '.' 2>/dev/null || echo "$RESPONSE"

# Check if successful
if echo "$RESPONSE" | grep -q '"status":1'; then
    echo ""
    echo "‚úÖ Test notification sent successfully!"
    echo "Check your iPhone 13 Mini for the notification."
else
    echo ""
    echo "‚ùå Failed to send notification"
fi
