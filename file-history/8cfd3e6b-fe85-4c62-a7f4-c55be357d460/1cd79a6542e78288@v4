# mql5-crossover Project Memory

**Architecture**: Link Farm + Hub-and-Spoke with Progressive Disclosure

## Navigation Index

**Entry Point**: `/Users/terryli/eon/mql5-crossover/README.md ` - Project overview and quick start

## Core Guides

- **[QUICKSTART.md](docs/guides/QUICKSTART.md)** - 5-minute setup and validation
- **[WINE_PYTHON_EXECUTION.md](docs/guides/WINE_PYTHON_EXECUTION.md)** - v3.0.0 Wine Python execution (production) - CX_BOTTLE, path navigation, RSI formula, diagnostics
- **[AI_AGENT_WORKFLOW.md](docs/guides/AI_AGENT_WORKFLOW.md)** - Complete development workflow for AI agents
- **[CROSSOVER_MQ5.md](docs/guides/CROSSOVER_MQ5.md)** - MT5/CrossOver technical reference and shell setup (v2.0.0 legacy)
- **[BOTTLE_TRACKING.md](docs/guides/BOTTLE_TRACKING.md)** - CrossOver bottle file tracking via X: drive mapping

## Implementation Plans

- **[HEADLESS_EXECUTION_PLAN.md](docs/plans/HEADLESS_EXECUTION_PLAN.md)** - v3.0.0 Python API approach (COMPLETE)
  - **Supersedes**: v2.0.0 startup.ini approach (conditionally working only)
  - **Key Achievement**: True headless execution without GUI initialization
  - **Status**: All 5 phases complete, cold start validated

## Validation Reports

- **[VALIDATION_STATUS.md](docs/reports/VALIDATION_STATUS.md)** - Current SLO metrics and test results
- **[SUCCESS_REPORT.md](docs/reports/SUCCESS_REPORT.md)** - Manual and headless validation (0.999902 correlation)

## Architecture

### Directory Structure

```
mql5/          # MQL5 source (Scripts/, Include/, Samples/)
python/        # Python validation tools
scripts/       # Automation (mq5run wrapper for v2.0.0)
docs/          # Documentation (guides/, plans/, reports/, archive/)
config/        # MT5 configuration files
exports/       # CSV outputs (gitignored)
logs/          # Execution logs (gitignored)
```

### Single Source of Truth

| Topic                       | Authoritative Document                  |
| --------------------------- | --------------------------------------- |
| Quick Start                 | `docs/guides/QUICKSTART.md`             |
| Wine Python Execution (v3.0.0) | `docs/guides/WINE_PYTHON_EXECUTION.md`  |
| Development Workflow        | `docs/guides/AI_AGENT_WORKFLOW.md`      |
| MT5/CrossOver Setup (v2.0.0) | `docs/guides/CROSSOVER_MQ5.md`          |
| Bottle File Tracking        | `docs/guides/BOTTLE_TRACKING.md`        |
| Headless Execution Plan     | `docs/plans/HEADLESS_EXECUTION_PLAN.md` |
| Validation Status           | `docs/reports/VALIDATION_STATUS.md`     |
| Historical Context          | `docs/archive/historical.txt`           |

## Key Commands

```bash
# Compile MQL5
mq5c mql5/Scripts/ExportAligned.mq5

# Export data (v3.0.0 - true headless, PRODUCTION)
CX_BOTTLE="MetaTrader 5" \
WINEPREFIX="$HOME/Library/Application Support/CrossOver/Bottles/MetaTrader 5" \
wine "C:\\Program Files\\Python312\\python.exe" \
  "C:\\users\\crossover\\export_aligned.py" \
  --symbol EURUSD --period M1 --bars 5000

# Copy CSV to repo
cp "$HOME/Library/Application Support/CrossOver/Bottles/MetaTrader 5/drive_c/users/crossover/exports/Export_EURUSD_PERIOD_M1.csv" exports/

# Export data (v2.0.0 - LEGACY, requires GUI initialization)
./scripts/mq5run --symbol EURUSD --period PERIOD_M1

# Validate
python python/validate_export.py exports/Export_EURUSD_PERIOD_M1.csv
```

## Service Level Objectives

- **Availability**: 100% ✓ (20 files accessible)
- **Correctness**: 100% ✓ (0.999902 correlation, all references resolved)
- **Observability**: 100% ✓ (14 reorg commits)
- **Maintainability**: 100% ✓ (organized hierarchy, language conventions)

## Critical Requirements & Limitations

### v3.0.0 (Python API) - PRODUCTION ✅

**Status**: Fully validated (2025-10-13 19:45)

**Requirements**:
- Wine Python 3.12+ with MetaTrader5 5.0.5328 and NumPy 1.26.4 (not 2.x)
- **CX_BOTTLE environment variable** (mandatory for CrossOver's wine wrapper)
- MT5 terminal running and logged in
- Correct RSI formula: `alpha=1/period` (not `span=period`)
- Validator with column name normalization

**Capabilities**:
- ✅ **True headless** - works for ANY symbol/timeframe without GUI initialization
- ✅ Cold start validated: USDJPY M1 (0.999920 correlation)
- ✅ Programmatic symbol selection via `mt5.symbol_select()`
- ✅ Direct data fetch via `mt5.copy_rates_from_pos()`

**Critical Path Operations**:
- macOS → Wine execution: Use `CX_BOTTLE` + `WINEPREFIX` + wine command
- Python script paths: Windows-style `C:\users\crossover\...`
- CSV copy: macOS native paths `~/Library/.../drive_c/users/...`
- See `docs/guides/WINE_PYTHON_EXECUTION.md ` for complete path navigation guide

### v2.0.0 (startup.ini) - LEGACY ⚠️

**Status**: Deprecated (use v3.0.0 instead)

**Limitations**:
- ⚠️ **Conditional** - requires manual GUI initialization per symbol/timeframe
- Each new symbol must be opened in MT5 GUI once before headless works
- startup.ini `[StartUp]` section attaches to existing charts only (cannot create new charts)

**Recommendation**: Migrate to v3.0.0 for production use

## Research Context

**Historical Findings**: `docs/archive/historical.txt ` (2022-2025 community research)
**Archived Plans**: `docs/archive/HEADLESS_EXECUTION_PLAN.v2.0.0.archived.md ` (startup.ini approach)

## Project Status

- **Version**: 1.0.0 (reorganization complete 2025-10-13)
- **Headless Execution**: v3.0.0 PRODUCTION (Python API, true headless validated)
- **Latest Validation**: USDJPY M1 cold start - 0.999920 RSI correlation (2025-10-13 19:45)
- **Critical Discoveries**:
  - CX_BOTTLE environment variable requirement
  - RSI formula fix (span → alpha)
  - Column name normalization
  - Path navigation patterns (macOS ↔ Wine)
- **Structure**: Clean organized hierarchy with SLO compliance
- **Documentation**: Complete empirical workflow guide (`WINE_PYTHON_EXECUTION.md`)

---

**Navigation Tip**: All paths are relative from project root. Use Cmd+click in Ghostty terminal for direct file access.
