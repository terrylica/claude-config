# iTerm2 + tmux Integration Configuration
# Version: 1.0.0
# Created: 2025-10-31
#
# Purpose: Enhanced tmux configuration optimized for iTerm2's native tmux integration
# Usage: tmux -CC -f ~/.claude/tmux/config/tmux-iterm2.conf new -A -s main
#
# Key Features:
#   - iTerm2 native window/tab integration
#   - Proper title display in iTerm2 tabs
#   - Shell integration compatibility
#   - Optimized for -CC (Control Mode)
#
# Documentation: ~/scripts/automation/iterm2/README.md

# ========================================
# SHELL CONFIGURATION
# ========================================

# Set default shell to zsh
set -g default-shell /bin/zsh
set -g default-command /bin/zsh

# ========================================
# TERMINAL & DISPLAY SETTINGS
# ========================================

# Set default terminal mode for proper color support
# iTerm2 auto-detects this and translates control sequences accordingly
set -g default-terminal "screen-256color"

# Enable true color support (if terminal supports it)
set -ga terminal-overrides ",xterm-256color:Tc"

# ========================================
# ITERM2 INTEGRATION
# ========================================

# Enable window titles (critical for iTerm2 tab names)
set-option -g set-titles on

# Set title string to show current pane title
# This makes iTerm2 tab titles meaningful
set-option -g set-titles-string '#T'

# Allow terminal title to be set by programs
set-option -g allow-rename on

# Automatically rename windows based on running program
set-window-option -g automatic-rename on

# ========================================
# MOUSE SUPPORT
# ========================================

# Enable mouse support (works well with iTerm2)
set -g mouse on

# ========================================
# WINDOW & PANE INDEXING
# ========================================

# Start windows and panes at 1, not 0 (easier to reach on keyboard)
set -g base-index 1
set -g pane-base-index 1

# Automatically renumber windows when one is closed
set -g renumber-windows on

# ========================================
# HISTORY & SCROLLBACK
# ========================================

# Increase scrollback buffer size
set -g history-limit 50000

# ========================================
# STATUS BAR
# ========================================

# Update status bar every 5 seconds
set -g status-interval 5

# Status bar colors (minimal design for iTerm2)
set -g status-style bg=colour235,fg=colour250

# Left status: Session name
set -g status-left-length 40
set -g status-left "#[fg=colour39,bold]#{session_name} #[fg=colour245]â”‚ "

# Right status: Date and time
set -g status-right "#[fg=colour245]%Y-%m-%d %H:%M"

# Window status format (current window highlighted)
setw -g window-status-current-format "#[fg=colour39,bg=colour238,bold] #I:#W "
setw -g window-status-format "#[fg=colour245] #I:#W "

# ========================================
# PANE BORDERS
# ========================================

# Pane border colors
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour39,bold

# ========================================
# MESSAGE DISPLAY
# ========================================

# Message colors
set -g message-style bg=colour235,fg=colour39,bold

# Display messages for 2 seconds
set -g display-time 2000

# ========================================
# ACTIVITY MONITORING
# ========================================

# Monitor for activity in background windows
setw -g monitor-activity on

# Display message when activity occurs
set -g visual-activity on

# ========================================
# COPY MODE (vi-style)
# ========================================

# Use vi key bindings in copy mode
setw -g mode-keys vi

# vi-style copy mode key bindings
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind-key -T copy-mode-vi r send-keys -X rectangle-toggle

# ========================================
# KEY BINDINGS
# ========================================
# Note: When using iTerm2 integration (-CC mode), prefer iTerm2 native
# keyboard shortcuts over tmux bindings where possible

# Reload configuration
bind-key r source-file ~/.claude/tmux/config/tmux-iterm2.conf \; display-message "iTerm2 tmux config reloaded!"

# Quick session switching
bind-key S choose-session

# Split panes using | and - (more intuitive)
bind-key | split-window -h -c "#{pane_current_path}"
bind-key - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Switch panes using Alt+Arrow (without prefix)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Resize panes with Prefix + Ctrl+Arrow
bind-key -r C-Up resize-pane -U 5
bind-key -r C-Down resize-pane -D 5
bind-key -r C-Left resize-pane -L 5
bind-key -r C-Right resize-pane -R 5

# ========================================
# SESSION MANAGEMENT
# ========================================

# Don't detach on session destroy
set -g detach-on-destroy off

# ========================================
# ESCAPE TIME
# ========================================

# Reduce escape time for faster command sequences
# Important for vim/neovim users
set -sg escape-time 10

# ========================================
# FOCUS EVENTS
# ========================================

# Enable focus events (useful for vim/neovim)
set -g focus-events on

# ========================================
# CLIPBOARD INTEGRATION
# ========================================

# Enable clipboard integration with pbcopy (macOS)
# In copy mode, y will copy to system clipboard
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"

# ========================================
# ITERM2-SPECIFIC SETTINGS
# ========================================

# These settings are optimized for iTerm2's -CC mode:
# - Titles are properly set for tab names
# - Window renaming works with iTerm2 native tabs
# - Colors are optimized for iTerm2's rendering
# - Mouse support integrates with iTerm2's mouse handling

# To use this configuration with iTerm2 integration:
# 1. Start tmux with: tmux -CC -f ~/.claude/tmux/config/tmux-iterm2.conf new -A -s main
# 2. Or set up an iTerm2 profile to run this automatically
# 3. iTerm2 will open native windows/tabs for tmux windows/panes

# ========================================
# NOTES
# ========================================

# - This config is designed for iTerm2's native tmux integration (-CC mode)
# - In -CC mode, iTerm2 manages the UI, tmux manages session persistence
# - Prefer iTerm2 keyboard shortcuts over tmux bindings when possible
# - Status bar is minimal since iTerm2 provides its own UI chrome
# - Window titles automatically update iTerm2 tab names

# For more information:
# - iTerm2 tmux integration: https://iterm2.com/documentation-tmux-integration.html
# - This setup guide: ~/scripts/automation/iterm2/README.md
