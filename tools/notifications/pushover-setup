#!/bin/bash
# Pushover Application Token Setup
# Usage: pushover-setup <your-30-character-api-token>

if [[ $# -ne 1 ]]; then
    echo "Usage: pushover-setup <pushover-app-token>"
    echo "Get your token from: https://pushover.net/apps/build"
    echo "Token must be 30 characters (A-Z, 0-9)"
    exit 1
fi

TOKEN="$1"

# Validate token format (30 chars, A-Z and 0-9 only)
if [[ ! "$TOKEN" =~ ^[A-Z0-9]{30}$ ]]; then
    echo "Error: Token must be exactly 30 characters (A-Z, 0-9 only)"
    exit 1
fi

# Add to keychain
security add-generic-password -s "pushover-app-token" -a "terryli" -w "$TOKEN"

if [[ $? -eq 0 ]]; then
    echo "‚úÖ Pushover application token added to keychain"
    
    # Test notification
    echo "üß™ Testing notification to iPhone 13 mini..."
    pushover-notify "Setup Complete" "Pushover integration is now working!"
else
    echo "‚ùå Failed to add token to keychain"
    exit 1
fi